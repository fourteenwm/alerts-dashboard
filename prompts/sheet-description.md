# Developer Brief: Google Ads Data Integration for React Next.js App

## Data Source Overview
Your Next.js app integrates with Google Sheets data generated by our Google Ads script. The sheet contains two tabs that must be handled consistently in both development and production environments.

## Data Fetching Implementation
1. **Use SWR for Data Fetching**
   - Always use `useSWR` for data fetching to ensure consistent behavior
   - Properly type the SWR hook: `useSWR<TabData>(settings.sheetUrl, fetchAllTabsData)`
   - Handle loading and error states appropriately

2. **Type Safety**
   - Use proper type assertions when accessing tab data
   - For search terms: `const searchTerms = (tabsData?.searchTerms || []) as SearchTermMetric[]`
   - For daily data: `const dailyData = (tabsData?.daily || []) as AdMetric[]`

## Tab 1: "SearchTerms"
This tab contains search term performance data:

| Header | Type | Description |
|--------|------|-------------|
| searchTerm | string | The actual search query used |
| keywordText | string | The keyword text |
| campaign | string | Campaign name |
| adGroup | string | Ad group name |
| impr | number | Number of ad impressions |
| clicks | number | Number of clicks received |
| cost | number | Cost in account currency (already converted from micros) |
| conv | number | Number of conversions |
| value | number | Total conversion value |
| cpc | number | Cost per click, calculated in the script |
| ctr | number | Click-through rate, calculated in the script |
| convRate | number | Conversion rate, calculated in the script |
| cpa | number | Cost per acquisition, calculated in the script |
| roas | number | Return on ad spend, calculated in the script |

## Tab 2: "Daily"
This tab contains daily campaign performance data:

| Header | Type | Description |
|--------|------|-------------|
| date | string | Date in YYYY-MM-DD format |
| campaign | string | Campaign name |
| campaignId | string | Campaign ID (stored as string) |
| impr | number | Number of impressions |
| clicks | number | Number of clicks received |
| value | number | Conversion value |
| conv | number | Number of conversions |
| cost | number | Cost in account currency (already converted from micros) |

## Implementation Notes

1. **Data Types & Parsing**: 
   - Always use type guards when handling data: `isSearchTermMetric` and `isAdMetric`
   - Parse numeric fields with `Number()`: `Number(row['clicks'] || 0)`
   - Use nullish coalescing for defaults: `row['campaign'] || ''`
   - Ensure consistent typing between dev/prod: use `TabData` interface

2. **Percentage Values**: 
   - Calculated metrics (CTR, CvR) are computed on the frontend from core metrics.
   - Format for display using `formatPercent(value)` (Note: frontend calculation already scales to %)

3. **Currency Values**: 
   - Use the account's currency setting from context
   - Format using `formatCurrency(value, settings.currency)`
   - Applies to: cost, value (fetched), CPA, CPC (calculated on frontend)

4. **Error Handling**: 
   - Always provide fallback empty arrays: `tabsData?.searchTerms || []`
   - Type check data before processing
   - Log errors in development for debugging

5. **Data Fetching Pattern**:
```typescript
const { data: tabsData, error, isLoading } = useSWR<TabData>(
    settings.sheetUrl,
    fetchAllTabsData
)

// Handle loading and error states
if (error) return <ErrorComponent />
if (isLoading) return <LoadingComponent />

// Type assertion for specific tab data
const data = (tabsData?.targetTab || []) as TargetMetricType[]
```

6. **Sorting and Filtering**: 
   - Implement client-side sorting/filtering
   - Sort numeric values using `Number()` conversion
   - Handle string collation for text fields

7. **Performance Considerations**:
   - Limit displayed rows (e.g., `.slice(0, 10)`)
   - Implement pagination for large datasets
   - Cache data using SWR's built-in caching

Remember: The key to consistent behavior between development and production is proper typing, consistent data fetching patterns, and thorough error handling.

